# 月を水面で飼う — 月相実装 最終設計ドキュメント

本ドキュメントは「水面に映る月を飼う」という体験テーマを前提に、
**月相（新月〜満月）を導入しつつ、水面を触る体験価値を決して損なわない**ための
最終的な設計指針・実装方針をまとめたものである。

---

## 0. 作品テーマの再定義（最重要）

この作品の主役は：

* 月そのものではない
* 天文学的な正確さでもない

**主役は「水面を介して月を飼う体験」そのもの**である。

ユーザーが行っている行為は：

* 月を見ることではなく
* 月を触ることでもなく

👉 **水面を触ることで、月の存在を感じること**。

したがって、

* 月相は「世界の状態」として存在する
* 水面の触感は「常に応答する存在」として保証されなければならない

この優先順位は、以降すべての設計判断に優先する。

---

## 1. 問題設定

### 1.1 直感的だが破綻する設計

「月相が新月に近づくほど、受光量を減らす」

という単純な設計は、物理的には正しく見えるが、
本作では次の問題を引き起こす：

* 水面の向こうの月がほぼ見えなくなる
* 歪みが読み取れなくなる
* 波を立てても光らず、触っている感覚が消える

👉 **体験のフィードバックが失われる**。

このため、

> 水面の受光量を月相にそのまま従属させる

という設計は不採用とする。

---

## 2. 解決方針の中核：受光の分離（デカップリング）

水面が受け取る光を、意味的に二層に分けて扱う。

### 2.1 Moon-driven Light（世界の状態）

* 月相に応じて変化してよい光
* 「今日は満月だ」「今日は新月だ」を表す

対象：

* 月面の照らされ方（欠け）
* 月色のスペキュラ反射（控えめ）

### 2.2 Interaction-driven Light（体験の保証）

* 月相に関係なく、必ず残る光
* ユーザーが触ったことへの応答

対象：

* 波頭のハイライト
* 歪みの視認性
* 触った瞬間の「生きている感」

👉 **Interaction-driven Light は月相に従属させない**。

---

## 3. 月相の扱い（世界パラメータ）

### 3.1 表現パラメータ

* `phase01` : 月相（0〜1）

  * 0.0 = 新月
  * 0.5 = 満月
* `fraction01` : 照明率（0〜1）

### 3.2 計算方法

* オフライン計算
* SunCalc などの既存ライブラリ使用を前提
* 正確性よりも**時間変化が滑らかであること**を重視

---

## 4. 月相が影響するもの（影響してよい）

### 4.1 水中シーン（underwaterScene）

* 月は MeshStandard / PhongMaterial に変更
* DirectionalLight（太陽役）を配置
* 月相に応じてライト方向を回転

結果：

* 新月：月はほぼ暗く、縁のみが見える
* 満月：全面が照らされる

これが renderTarget を通して水面に映る。

### 4.2 星の量

* 満月ほど星は少ない
* 新月ほど星は多い

星は「世界の明るさ」の指標なので、月相連動は自然。

---

## 5. 月相が影響してはならないもの（最重要）

### 5.1 水面の触感

以下は **常に可視でなければならない**：

* 波が立ったこと
* 歪みが発生したこと
* 水面が反応していること

理由：

* ユーザーは月ではなく水面を触っているため

👉 月相によって「触ったのに何も起きない」は許容しない。

---

## 6. 水面シェーダー設計（最終形）

### 6.1 波頭ハイライト

波頭の光は二段構えとする：

* **Base（常時保証）**
* **Moon Add（月相連動・控えめ）**

```glsl
float waveSignal = smoothstep(0.01, 0.06, vHeight);

float waveBase    = waveSignal * 0.35;                 // 常時残す
float waveMoonAdd = waveSignal * 0.20 * pow(fraction, 0.7);

float waveHighlight = waveBase + waveMoonAdd;
```

### 6.2 スペキュラ（月由来）

* 月相で増減してよい
* ただしゼロにはしない

```glsl
float specGain = mix(0.12, 0.25, pow(fraction, 0.8));
vec3 moonlightReflect = moonColor * spec * specGain;
```

### 6.3 歪み（屈折）

* 新月ほど見えなくなる問題を補正
* 暗いほど歪みを強調

```glsl
float distortGain = mix(1.15, 1.0, pow(fraction, 0.8));
vec2 distortion = baseDistortion * distortGain;
```

---

## 7. 触った瞬間の体験補強（任意だが推奨）

### 7.1 Touch Energy

* 触った瞬間だけ発生する補助光
* 時間とともに減衰

目的：

* 新月でも「触った感触」を即座に返す
* 常時明るくしないことで世界観を守る

```glsl
float interaction = touchEnergy * smoothstep(0.02, 0.08, abs(vHeight));
vec3 touchGlow = interactionColor * interaction * 0.35;
finalColor += touchGlow;
```

---

## 8. UI（補助的存在）

* 左下に hover 表示の月相スライダー
* 右下クレジットと同様の構造

役割：

* 制作・検証用
* 体験の主導線にはしない

---

## 9. 設計原則まとめ

1. 月相は「世界の状態」であり、主役ではない
2. 水面は常に触れる存在でなければならない
3. 体験フィードバックは月相より優先される
4. 物理的正しさより、因果が感じられることを重視する

---

## 最終宣言

> 月が見えない夜でも、水面は応えてくれる。
> それを飼っている。

この作品は、
**月を描く作品ではなく、月を介した水面との関係を育てる作品**である。
